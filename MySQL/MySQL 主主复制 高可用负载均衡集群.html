<!DOCTYPE html>
<html>
<head>
    <title>MySQL 主主复制 高可用负载均衡集群</title>

    <meta charset="UTF-8"/>

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>

    <meta name="HandheldFriendly" content="true"/>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>

    <link href="../asset/fit/basic_markdown.css" type="text/css" rel="stylesheet"/>
    <link href="../asset/fit/style.css" type="text/css" rel="stylesheet"/>
    <link href="../asset/fit/sidebar/auto_sidebar.css" type="text/css" rel="stylesheet"/>

    <style type="text/css">
        body {margin-left: 270px}
        .index {width: 270px}

        
            span.md_line{margin-bottom:0.5em; display:block; line-height:1.89}
            .md_line br{ display: none;}
            
    </style>

    <script>
        var flowchat_options = {
            'x': 0, 'y': 0, 'line-width': 1, 'line-length': 50, 'text-margin': 10, 'font-size': 13,
            'font-color': '#3c3c3c', 'line-color': '#666666', 'element-color': '#666666', 'fill': 'transparent',
            'yes-text': 'yes', 'no-text': 'no', 'arrow-end': 'block', 'class': 'flowchart', 'scale': 1,
            'symbols': { 'start': {}, 'end': {}, 'condition': {}, 'inputoutput': {}, 'operation': {}, 'subroutine': {}}
        }
    </script>
    <script type="text/javascript" src="../asset/other/raphael-min.js"></script>
    <script type="text/javascript" src="../asset/other/flowchart.js"></script>
    <script type="text/javascript" src="../asset/other/echarts.min.js"></script>

    <link href="../asset/other/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="../asset/other/mermaid/mermaid.min.js"></script>


</head>

<body>





<div class="sidebar">
    <div class="sidebar_body">
        <div class="index">
            <ul class="index_body">
                <li class="title">
                    <a href="../index.html">大漠知秋的小秘密</a>
                </li>
                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>1</b> Docker CE</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker Compose 使用.html" ><b>1.1</b> Docker Compose 使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker Dockerfile 定制镜像.html" ><b>1.2</b> Docker Dockerfile 定制镜像</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 仓库.html" ><b>1.3</b> Docker Hub</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 单台宿主机多应用部署.html" ><b>1.4</b> 实验环境</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 基本概念.html" ><b>1.5</b> Docker 基本概念</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 基本网络功能.html" ><b>1.6</b> Docker 基本网络功能</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 多台宿主机多应用部署.html" ><b>1.7</b> Docker 多台宿主机多应用部署</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 安装.html" ><b>1.8</b> Docker 安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 容器.html" ><b>1.9</b> Docker 容器</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 数据管理.html" ><b>1.10</b> Docker 数据管理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 私有仓库.html" ><b>1.11</b> 安装运行 docker-registry</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 简介.html" ><b>1.12</b> Docker 简介</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 网络深入理解.html" ><b>1.13</b> Docker 网络深入理解</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 镜像.html" ><b>1.14</b> Docker 镜像</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 镜像加速器.html" ><b>1.15</b> Docker 镜像加速器</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口.html" ><b>1.16</b> 问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>2</b> Elasticsearch</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Elasticsearch/问题 - Elasticsearch 问题收集.html" ><b>2.1</b> 问题 - Elasticsearch 问题收集</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>3</b> FastDFS</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../FastDFS/FastDFS 单机安装.html" ><b>3.1</b> FastDFS 单机安装</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>4</b> Git</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Git/GitHub 上同步 Fork 的代码.html" ><b>4.1</b> GitHub 上同步 Fork 的代码</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>5</b> GitLab</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/Docker GitLab SSH 坑.html" ><b>5.1</b> Docker GitLab SSH 坑</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/Docker 安装 GitLab.html" ><b>5.2</b> Docker 安装 GitLab</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/如何查看 GitLab 版本号.html" ><b>5.3</b> 如何查看 GitLab 版本号</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/问题 - GitLab repositories 文件夹权限异常.html" ><b>5.4</b> 问题 - GitLab repositories 文件夹权限异常</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>6</b> Golang</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/channel.html" ><b>6.1</b> channel</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/goroutine.html" ><b>6.2</b> goroutine</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/函数.html" ><b>6.3</b> 函数</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/匿名函数与闭包.html" ><b>6.4</b> 匿名函数与闭包</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/变量.html" ><b>6.5</b> 变量</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/基础环境安装.html" ><b>6.6</b> 基础环境安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/常量.html" ><b>6.7</b> 常量</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/并发 - 同步.html" ><b>6.8</b> 并发 - 同步</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/数据类型.html" ><b>6.9</b> 数据类型</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/流程控制.html" ><b>6.10</b> 流程控制</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/语言特性.html" ><b>6.11</b> 语言特性</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/错误处理.html" ><b>6.12</b> 错误处理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/问题 - 出让时间片.html" ><b>6.13</b> 问题 - 出让时间片</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/问题 - 多核并行化.html" ><b>6.14</b> 问题 - 多核并行化</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 使用组合和定义别名.html" ><b>6.15</b> 面向对象 - 使用组合和定义别名</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 接口.html" ><b>6.16</b> 面向对象 - 接口</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 类型系统.html" ><b>6.17</b> 面向对象 - 类型系统</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 结构体.html" ><b>6.18</b> 面向对象 - 结构体</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面型对象 - 包和封装.html" ><b>6.19</b> 命名规范</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>7</b> Http Client 4.5.2</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Http Client 4.5.2/为GET和POST请求添加请求参数和请求头.html" ><b>7.1</b> 为GET和POST请求添加请求参数和请求头</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Http Client 4.5.2/入门.html" ><b>7.2</b> 入门</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>8</b> Java</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Java/使用 Undertow 替换掉 Tomcat.html" ><b>8.1</b> 使用 Undertow 替换掉 Tomcat</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Java/编写高质量代码 - Java.html" ><b>8.2</b> 编写高质量代码 - Java</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Java/问题 - Spring Boot 以流的方式读取配置文件.html" ><b>8.3</b> 问题 - Spring Boot 以流的方式读取配置文件</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>9</b> Kubernetes</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/Kubernetes 1.14 kubeadm 集群安装.html" ><b>9.1</b> Kubernetes 1.14 kubeadm 集群安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/Kubernetes 1.14 开启 IPVS.html" ><b>9.2</b> Kubernetes 1.14 开启 IPVS</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/Kubernetes 1.6.1 kubeadm 集群安装.html" ><b>9.3</b> Kubernetes 1.6.1 kubeadm 集群安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/kubeadm 安装 k8s 集群.html" ><b>9.4</b> kubeadm 安装 k8s 集群</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/《Kubernetes权威指南》1.3案例部署及问题解决.html" ><b>9.5</b> 《Kubernetes权威指南》1.3案例部署及问题解决</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/安装 Dashboard.html" ><b>9.6</b> 安装 Dashboard</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/问题 - kubectl create 一直处于 ContainerCreating 状态.html" ><b>9.7</b> 问题 - kubectl create 一直处于 ContainerCreating 状态</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>10</b> Linux</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/CentOS 升级内核.html" ><b>10.1</b> CentOS 升级内核</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/Firewalld 详解.html" ><b>10.2</b> Firewalld 详解</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/RHEL 6 和 RHEL 7 的一些区别.html" ><b>10.3</b> RHEL 6 和 RHEL 7 的一些区别</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/RHEL 7 常用命令.html" ><b>10.4</b> RHEL 7 常用命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/RHEL 的目录结构.html" ><b>10.5</b> RHEL 的目录结构</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/SWAP交换分区（虚拟内存）.html" ><b>10.6</b> SWAP交换分区（虚拟内存）</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/SWAP虚拟内存配置.html" ><b>10.7</b> SWAP虚拟内存配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/Shell 脚本入门.html" ><b>10.8</b> Shell 脚本入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/curl 命令.html" ><b>10.9</b> curl 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/find 命令的使用.html" ><b>10.10</b> 常用命令组合</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/tar 命令.html" ><b>10.11</b> 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/一次服务器中病毒挖矿事件处理.html" ><b>10.12</b> 一次服务器中病毒挖矿事件处理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/使用 systemd 开机启动.html" ><b>10.13</b> 使用 systemd 开机启动</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/常用 rpm 命令.html" ><b>10.14</b> 常用 rpm 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/常用 yum 命令.html" ><b>10.15</b> 常用 yum 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/常用的转义字符.html" ><b>10.16</b> 常用的转义字符</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/挂载硬件设备.html" ><b>10.17</b> 挂载硬件设备</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/文件权限与归属.html" ><b>10.18</b> 文件权限与归属</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/文件系统与数据资料.html" ><b>10.19</b> 文件系统与数据资料</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/添加硬盘设备.html" ><b>10.20</b> 添加硬盘设备</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/物理设备的命名规则.html" ><b>10.21</b> 物理设备的命名规则</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/环境变量和命令的执行步骤.html" ><b>10.22</b> 环境变量和命令的执行步骤</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/用户管理.html" ><b>10.23</b> 用户管理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/磁盘容量配额.html" ><b>10.24</b> 磁盘容量配额</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/管道命令符.html" ><b>10.25</b> 管道命令符</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/计划任务服务程序（定时任务）.html" ><b>10.26</b> 计划任务服务程序（定时任务）</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/软硬方式链接（快捷方式）.html" ><b>10.27</b> 软硬方式链接（快捷方式）</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/输入输出重定向.html" ><b>10.28</b> 输入输出重定向</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口.html" ><b>10.29</b> 问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/问题 - Linux 项目输出日志中文变问号.html" ><b>10.30</b> 问题 - Linux 项目输出日志中文变问号</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/防火墙 - firewalld.html" ><b>10.31</b> 防火墙 - firewalld</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/防火墙 - iptables.html" ><b>10.32</b> 防火墙 - iptables</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>11</b> Maven</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Maven/Docker 安装 Maven 私服 Nexus 3.12.1.html" ><b>11.1</b> Docker 安装 Maven 私服 Nexus 3.12.1</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>12</b> MySQL</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/ContOS7.4 + MySQL5.6.40安装.html" ><b>12.1</b> ContOS7.4 + MySQL5.6.40安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/Galera Cluster For MySQL.html" ><b>12.2</b> Galera Cluster For MySQL</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/MySQL Yum 存储库安装.html" ><b>12.3</b> MySQL Yum 存储库安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item active">
        
        
        <a class="link_in_site" href="../MySQL/MySQL 主主复制 高可用负载均衡集群.html" ><b>12.4</b> MySQL 主主复制 高可用负载均衡集群</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/MySQL 用户管理及授权.html" ><b>12.5</b> MySQL 用户管理及授权</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>13</b> Nginx</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/Nginx 处理跨域问题.html" ><b>13.1</b> Nginx 处理跨域问题</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/Nginx 重定向 HTTP 到 HTTPS.html" ><b>13.2</b> Nginx 重定向 HTTP 到 HTTPS</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/在已安装的 Nginx 上追加 module.html" ><b>13.3</b> 在已安装的 Nginx 上追加 module</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/问题 - .斜杠Configure darwin64-x86_64-cc.html" ><b>13.4</b> 问题 - .斜杠Configure darwin64-x86_64-cc</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>14</b> Rabbit MQ</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Rabbit MQ/RabbitMQ + Keepalived + HAProxy 高可用镜像集群.html" ><b>14.1</b> RabbitMQ + Keepalived + HAProxy 高可用镜像集群</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>15</b> Redis</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Redis/Redis Cluster 从零安装并详解.html" ><b>15.1</b> Redis Cluster 从零安装并详解</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>16</b> Spring</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring/使用 ApplicationContextAware 获取 Spring 管理 Bean.html" ><b>16.1</b> 使用ApplicationContextAware接口</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>17</b> Spring Boot</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 制作一个自己的 Starter.html" ><b>17.1</b> Spring Boot 制作一个自己的 Starter</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 在 Redis Cluster RedisTemplate 基础上做缓存.html" ><b>17.2</b> Spring Boot 在 Redis Cluster RedisTemplate 基础上做缓存</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 结合 Redis Cluster RedisTemplate.html" ><b>17.3</b> Spring Boot 结合 Redis Cluster RedisTemplate</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 结合 Redis Cluster 简单使用.html" ><b>17.4</b> Spring Boot 结合 Redis Cluster 简单使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/使用 Undertow 替换掉 Tomcat.html" ><b>17.5</b> 使用 Undertow 替换掉 Tomcat</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/问题 - Spring Boot 以流的方式读取配置文件.html" ><b>17.6</b> 问题 - Spring Boot 以流的方式读取配置文件</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>18</b> Spring Cloud Finchley.RELEASE</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Client 自动刷新.html" ><b>18.1</b> Config Client 自动刷新</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server refresh 端点.html" ><b>18.2</b> Config Server refresh 端点</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 入门.html" ><b>18.3</b> Config Server 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 安全.html" ><b>18.4</b> Config Server 安全</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 本地覆盖远程.html" ><b>18.5</b> Config Server 本地覆盖远程</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 高可用.html" ><b>18.6</b> Config Server 高可用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureak 开启 HTTPS.html" ><b>18.7</b> Eureak 开启 HTTPS</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka Server REST API.html" ><b>18.8</b> Eureka Server REST API</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka Server 高可用.html" ><b>18.9</b> Eureka Server 高可用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 入门.html" ><b>18.10</b> Eureka 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 参数调优.html" ><b>18.11</b> Eureka 参数调优</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 常见故障.html" ><b>18.12</b> Eureka 常见故障</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 开启 HTTP Basic 认证.html" ><b>18.13</b> Eureka 开启 HTTP Basic 认证</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 的设计理念.html" ><b>18.14</b> 概述</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client Logger Configuration.html" ><b>18.15</b> Feign Client Logger Configuration</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client Upload File.html" ><b>18.16</b> Feign Client Upload File</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client 第一次请求超时.html" ><b>18.17</b> Feign Client 第一次请求超时</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client 超时配置.html" ><b>18.18</b> Feign Client 超时配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign GET 多参数传递.html" ><b>18.19</b> Feign GET 多参数传递</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign 基本使用.html" ><b>18.20</b> Feign 基本使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign 开启 GZIP 压缩.html" ><b>18.21</b> 配置文件新增</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign 默认 Client 替换.html" ><b>18.22</b> Feign 默认 Client 替换</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix Dashboard.html" ><b>18.23</b> Hystrix Dashboard</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix Turbine.html" ><b>18.24</b> Hystrix Turbine</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix 入门.html" ><b>18.25</b> Hystrix 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix 异常处理机制.html" ><b>18.26</b> Hystrix 异常处理机制</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix 配置说明.html" ><b>18.27</b> Hystrix 配置说明</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/OpenResty + Lua 动态增加 Zuul 节点.html" ><b>18.28</b> OpenResty + Lua 动态增加 Zuul 节点</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 入门.html" ><b>18.29</b> Ribbon 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 脱离 Eureka 进行负载.html" ><b>18.30</b> Ribbon 脱离 Eureka 进行负载</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 负载均衡策略配置.html" ><b>18.31</b> Ribbon 负载均衡策略配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 超时与重试.html" ><b>18.32</b> Ribbon 超时与重试</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 饥饿加载.html" ><b>18.33</b> Ribbon 饥饿加载</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Spring Boot Admin 使用.html" ><b>18.34</b> Spring Boot Admin 使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul Filter.html" ><b>18.35</b> Zuul Filter</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul serviceId 映射与 url 映射超时配置的不同.html" ><b>18.36</b> Zuul serviceId 映射与 url 映射超时配置的不同</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 上传文件.html" ><b>18.37</b> Zuul 上传文件</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 不向后端服务传递指定 Headers.html" ><b>18.38</b> Zuul 不向后端服务传递指定 Headers</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 使用 OKHttp 替换 HttpClient.html" ><b>18.39</b> Zuul 使用 OKHttp 替换 HttpClient</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 修改请求体内容.html" ><b>18.40</b> Zuul 修改请求体内容</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 入门.html" ><b>18.41</b> Zuul 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 基于 Eureka 元数据的弧度发布.html" ><b>18.42</b> Zuul 基于 Eureka 元数据的弧度发布</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 对 Hystrix 的线程隔离模式选择.html" ><b>18.43</b> Zuul 对 Hystrix 的线程隔离模式选择</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 屏蔽服务和指定路径.html" ><b>18.44</b> Zuul 屏蔽服务和指定路径</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 添加 Header.html" ><b>18.45</b> Zuul 添加 Header</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 路由前缀.html" ><b>18.46</b> Zuul 路由前缀</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 路由配置.html" ><b>18.47</b> Zuul 路由配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 重定向问题.html" ><b>18.48</b> Zuul 重定向问题</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 重试.html" ><b>18.49</b> Zuul 重试</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/使用 Undertow 替换掉 Tomcat.html" ><b>18.50</b> 使用 Undertow 替换掉 Tomcat</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>19</b> 吉他</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../吉他/左右手指说明.html" ><b>19.1</b> 左右手指说明</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../吉他/调音.html" ><b>19.2</b> 初识定音</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>20</b> 开发软件问题</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../开发软件问题/问题 - iTerm2 中文输出显示问号.html" ><b>20.1</b> 问题 - iTerm2 中文输出显示问号</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
            </ul>

        </div>

    </div>
</div>

<div class="content">
    <div class="content_body">
        <h2 class="post_title">
            MySQL 主主复制 高可用负载均衡集群
        </h2>
        <div class="post_body">
            <div class="markdown">
                <div class="toc_container">
<div class="toc"><ul>
<li>
<a href="#toc_0">MySQL 安装</a>
</li>
<li>
<a href="#toc_1">主主复制</a>
<ul>
<li>
<ul>
<li>
<a href="#toc_2">修改配置文件</a>
</li>
<li>
<a href="#toc_3">配置 192.168.117.139 的主从复制</a>
<ul>
<li>
<a href="#toc_4">创建 MySQL 用户</a>
</li>
<li>
<a href="#toc_5">查看二进制文件</a>
</li>
<li>
<a href="#toc_6">告知 192.168.117.140 主 MySQL 二进制文件名与位置</a>
</li>
<li>
<a href="#toc_7">查看结果</a>
</li>
</ul>
</li>
<li>
<a href="#toc_8">查看主主复制效果</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_9">中间件说明</a>
<ul>
<li>
<ul>
<li>
<a href="#toc_10">HAProxy</a>
</li>
<li>
<a href="#toc_11">Keepalived</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_12">中间件的安装与配置（HAProxy、Keepalived）</a>
<ul>
<li>
<ul>
<li>
<a href="#toc_13">HAProxy 安装</a>
<ul>
<li>
<a href="#toc_14">安装</a>
</li>
<li>
<a href="#toc_15">配置</a>
</li>
<li>
<a href="#toc_16">启动 HAProxy</a>
</li>
<li>
<a href="#toc_17">查看负载情况</a>
</li>
</ul>
</li>
<li>
<a href="#toc_18">Keepalived 安装</a>
<ul>
<li>
<a href="#toc_19">安装</a>
</li>
<li>
<a href="#toc_20">配置</a>
</li>
<li>
<a href="#toc_21">编写脚本文件</a>
</li>
<li>
<a href="#toc_22">启动 Keepalived</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_23">测试</a>
<ul>
<li>
<ul>
<li>
<a href="#toc_24">测试环境</a>
</li>
<li>
<a href="#toc_25">配置项</a>
</li>
<li>
<a href="#toc_26">测试伪代码</a>
</li>
<li>
<a href="#toc_27">测试</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<blockquote class="blockquote_lines_5">
<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_start md_line_end">搭建环境：</span>
</p>


<blockquote class="blockquote_lines_4">
<p class="md_block">
    <span class="md_line md_line_start">两台 CentOS 7.4（192.168.117.139、192.168.117.140）<br /></span>
    <span class="md_line">MySQL 5.7<br /></span>
    <span class="md_line">HAProxy 1.5.18<br /></span>
    <span class="md_line md_line_end">Keepalived 1.3.5</span>
</p>

</blockquote>
</blockquote>
<h1 id="toc_0" class="h16 md_first_h">MySQL 安装</h1>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　安装笔记参考<a class="md_compiled" href="https://blog.csdn.net/wo18237095579/article/details/80585486">MySQL Yum 存储库安装</a>，此处不再浪费“墨水”。两台机器按照相同步骤安装完成即可。</span>
</p>

<h1 id="toc_1" class="h16">主主复制</h1>

<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_start md_line_end">　　什么叫主主复制？就是两个 MySQL 都能读能写，数据记录通过二进制传达给对方从而保持数据的一致性。</span>
</p>


<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">192.168.117.139 主从复制 + 192.168.117.140 主从复制 == 192.168.117.139、192.168.117.140 主主复制）</span>
</p>

</blockquote>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　因此主主复制中必须要解决的事情就是自增主键的问题。如果 <code>MySQL1</code> 主键 id 增加到 999 了，此时二进制数据还没到达 MySQL2，那么 MySQL2 恰好要插入数据，那么新数据主键 id 也是 999，那不就是乱套了么！解决这一问题我们可以直接更改MySQL中的配置文件即可。</span>
</p>

<h3 id="toc_2" class="h16">修改配置文件</h3>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　如果按照上方笔记安装的话，MySQL 配置文件在：<code>/etc/my.cnf</code></span>
</p>


<pre><code># 192.168.117.139 服务器

[mysqld]

log-bin=mysql-bin # 开启二进制日志
binlog_format=mixed
server-id       = 1 # 任意自然数n，只要保证两台MySQL主机不重复就可以了。

auto_increment_increment=2 # 步进值auto_imcrement。一般有n台主 MySQL 就填n
auto_increment_offset=1 # 起始值。一般填第n台主MySQL。此时为第一台主MySQL
binlog-ignore-db=mysql # 忽略mysql库，一般不需要写
binlog-ignore-db=information_schema # 忽略information_schema库，一般不需要写
replicate-do-db=aa # 要同步的数据库，默认所有库

# 192.168.117.140 服务器

[mysqld]

server-id=2
log-bin=mysql-bin

auto_increment_increment=2
auto_increment_offset=2
replicate-do-db=aa</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　配置好后重启 MySQL</span>
</p>


<pre><code>systemctl restart mysqld</code></pre>

<!--block_code_end-->
<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　<strong>注意：</strong>如果使用的是虚拟机，进行的克隆，因为是整个系统的 &quot;Copy&quot; ，所以 MySQL 的 auto.cnf 文件中的 <code>server-uuid</code> 会相同，在后面主主复制操作时会出错，记得修改，两个不一样即可。auto.cnf 地址：<code>/var/lib/mysql/auto.cnf</code></span>
</p>

</blockquote>
<h3 id="toc_3" class="h16">配置 192.168.117.139 的主从复制</h3>
<h4 id="toc_4" class="h16">创建 MySQL 用户</h4>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　在 <code>192.168.117.139</code> 的 MySQL 上创建 <code>192.168.117.140</code> MySQL 登录使用 MySQL 用户并授予<code>从复制权限</code>（反之同样来一遍）。</span>
</p>


<pre><code># 创建 MySQL 用户
mysql&gt; CREATE USER 'mysql140'@'192.168.117.140' IDENTIFIED BY 'Mysql*140';
Query OK, 0 rows affected (0.00 sec)

# 授权
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO 'mysql140'@'192.168.117.140' IDENTIFIED BY 'Mysql*140';
Query OK, 0 rows affected, 1 warning (0.00 sec)

# 刷新权限
mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)</code></pre>

<!--block_code_end--><h4 id="toc_5" class="h16">查看二进制文件</h4>

<pre><code>mysql&gt; show master status;
+------------------+----------+--------------+--------------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB         | Executed_Gtid_Set |
+------------------+----------+--------------+--------------------------+-------------------+
| mysql-bin.000001 |      885 |              | mysql,information_schema |                   |
+------------------+----------+--------------+--------------------------+-------------------+
1 row in set (0.00 sec)</code></pre>

<!--block_code_end--><h4 id="toc_6" class="h16">告知 192.168.117.140 主 MySQL 二进制文件名与位置</h4>

<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　在 <code>192.168.117.140</code> 上的 MySQL 中执行</span>
</p>


<ul>
<li class="md_li"><span>
</span></li>
</ul>

<pre><code>mysql&gt; change master to master_host='192.168.117.139', master_user='mysql140', master_password='Mysql*140', master_log_file='mysql-bin.000001', master_log_pos=885;</code></pre>

<!--block_code_end--><h4 id="toc_7" class="h16">查看结果</h4>

<pre><code>mysql&gt; start slave;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; show slave status\G
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 192.168.117.139
                  Master_User: mysql140
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000001
          Read_Master_Log_Pos: 885
               Relay_Log_File: localhost-relay-bin.000002
                Relay_Log_Pos: 320
        Relay_Master_Log_File: mysql-bin.000001
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB: aa
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: 0
                   Last_Error:
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 885
              Relay_Log_Space: 531
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: 0
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 1
                  Master_UUID: 8a6cacf5-8029-11e8-ae8e-000c291537e4
             Master_Info_File: /var/lib/mysql/master.info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates
           Master_Retry_Count: 86400
                  Master_Bind:
      Last_IO_Error_Timestamp:
     Last_SQL_Error_Timestamp:
               Master_SSL_Crl:
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set:
            Executed_Gtid_Set:
                Auto_Position: 0
         Replicate_Rewrite_DB:
                 Channel_Name:
           Master_TLS_Version:
1 row in set (0.00 sec)</code></pre>

<!--block_code_end-->
<p class="md_block md_block_as_opening md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　<strong>上面几个关键点注意：</strong></span>
</p>


<ul>
<li class="md_li"><span><strong>Master_Host:</strong> 主库地址
</span></li>
<li class="md_li"><span><strong>Master_User:</strong> 连接主库使用的 用户
</span></li>
<li class="md_li"><span><strong>Master_Log_File:</strong> 主库二进制文件
</span></li>
<li class="md_li"><span><strong>Read_Master_Log_Pos:</strong> 主库二进制文件坐标
</span></li>
<li class="md_li"><span><strong>Slave_IO_Running:</strong> 与主库 IO 通信状态，需要为 <code>Yes</code> 方可
</span></li>
<li class="md_li"><span><strong>Slave_SQL_Running:</strong> 负责自己的 Slave MySQL 进行状态，需要为 <code>Yes</code> 方可
</span></li>
<li class="md_li"><span><strong>Replicate_Do_DB:</strong> 同步的 DB
</span></li>
</ul>

<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　至此，192.168.117.139 的主从复制配置成功。这些操作在 192.168.117.140 上再做一遍即可完成<strong>主主复制</strong></span>
</p>

</blockquote>
<h3 id="toc_8" class="h16">查看主主复制效果</h3>

<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　这里使用 Navicat 视图工具随便添加一点数据</span>
</p>


<ul>
<li class="md_li"><span>192.168.117.139 上新增 demo 表
</span></li>
</ul>

<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/8b7f4288eee6477b9257b963d1cb1d07.png" alt="139新增 demo 表" title="" ></span>
</p>


<ul>
<li class="md_li"><span>刷新 192.168.117.140 发现已经同步成功
</span></li>
</ul>

<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/1f91b360eba84c4b8900b0e39937a9b0.png" alt="已同步 demo" title="" ></span>
</p>


<ul>
<li class="md_li"><span>192.168.117.140 上新增 test 表
</span></li>
</ul>

<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/49bc8b30bc384d6fb91d9db95d7cd532.png" alt="140新增 test 表" title="" ></span>
</p>


<ul>
<li class="md_li"><span>刷新 192.168.117.139 发现已经同步成功
</span></li>
</ul>

<p class="md_block">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/c2dad2f245954e80b61b4caf536718e2.png" alt="已同步 test" title="" ></span>
</p>

<h1 id="toc_9" class="h16">中间件说明</h1>
<h3 id="toc_10" class="h16">HAProxy</h3>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　HAProxy 是一个开源的高性能的反向代理或者说是负载均衡服务软件之一，它支持双机热备、虚拟主机、基于TCP和HTTP应用代理等功能。其配置简单，而且拥有很好的对服务器节点的健康检查功能（相当于 keepalived 健康检查），当其代理的后端服务器出现故障时，HAProxy 会自动的将该故障服务器摘除，当服务器的故障恢复后 HAProxy 还会自动将 RS 服务器。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　HAProxy 特别适用于那些负载特大的 web 站点，这些站点通常又需要会话保持或七层处理。HAProxy 运行在当前的硬件上，完全可以支持数以万计的并发连接。并且它的运行模式使得它可以很简单安全的整合进您当前的架构中， 同时可以保护你的 web 服务器不被暴露到网络上。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　HAProxy 软件引入了 frontend，backend 的功能，frontend（acl规则匹配）可以根据任意HTTP请求头做规则匹配，然后把请求定向到相关的 backend（server pools等待前端把请求转过来的服务器组）。通过 frontend 和 backup，我们可以很容易的实现 HAProxy 的<code>7层代理功能</code>，HAProxy 是一款不可多得的优秀代理服务软件。</span>
</p>

<h3 id="toc_11" class="h16">Keepalived</h3>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　Keepalived 是以 <code>VRRP协议</code> 为实现基础的，VRRP 全称 Virtual Router Redundancy Protocol，即虚拟路由冗余协议。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　虚拟路由冗余协议，可以认为是实现路由器高可用的协议，即将N台提供相同功能的路由器组成一个路由器组，这个组里面有一个 Master 和多个 Backup，Master 上面有一个对外提供服务的 <code>vip</code>（该路由器所在局域网内其他机器的默认路由为该 <code>vip</code>），Master 会发组播，当 Backup 收不到 <code>vrrp</code> 包时就认为 Master 宕掉了，这时就需要根据 <code>VRRP</code> 的优先级来选举一个 Backup 当 Master。这样的话就可以保证路由器的高可用了。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　Keepalived 主要有三个模块，分别是 <code>core</code>、<code>check</code> 和 <code>vrrp</code>。<code>core模块</code>为 Keepalived 的核心，负责主进程的启动、维护以及全局配置文件的加载和解析。<code>check</code>负责健康检查，包括常见的各种检查方式。<code>vrrp</code>模块是来实现<code>VRRP协议</code>的。</span>
</p>

<h1 id="toc_12" class="h16">中间件的安装与配置（HAProxy、Keepalived）</h1>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　我这里全部都采用 yum 安装方式，源使用的是阿里云。</span>
</p>

<h3 id="toc_13" class="h16">HAProxy 安装</h3>
<h4 id="toc_14" class="h16">安装</h4>

<pre><code>[root@localhost ~]# yum -y install haproxy</code></pre>

<!--block_code_end--><h4 id="toc_15" class="h16">配置</h4>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　配置文件路径：<code>/etc/haproxy/haproxy.cfg</code></span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　添加关于 MySQL 的配置信息</span>
</p>


<pre><code>[root@localhost ~]# vim /etc/haproxy/haproxy.cfg

# 配置查看负载信息管理页面
listen stats
    mode http
    bind :8888
    stats enable
    stats hide-version
    stats uri     /haproxyadmin?stats
    stats realm   Haproxy\ Statistics
    stats auth    admin:admin

# MySQL 负载配置
listen proxy-mysql
    bind 0.0.0.0:13306
    mode tcp
    balance roundrobin
    option tcplog
    #option mysql-check user haproxy
    server MySQL1 192.168.117.139:3306 check weight 1 maxconn 2000
    server MySQL2 192.168.117.140:3306 check weight 1 maxconn 2000
    option tcpka</code></pre>

<!--block_code_end-->
<ul>
<li class="md_li"><span><strong>配置说明：</strong>
</span></li>
</ul>

<pre><code>global

    log         127.0.0.1 local2         //日志定义级别
    chroot      /var/lib/haproxy         //当前工作目录
    pidfile     /var/run/haproxy.pid     //进程id
    maxconn     4000                     //最大连接数
    user        haproxy                  //运行改程序的用户
    group       haproxy
    daemon                               //后台形式运行
    stats socket /var/lib/haproxy/stats

defaults
    mode                    tcp            //haproxy运行模式（http | tcp | health）
    log                     global
    option                  dontlognull
    option                  redispatch     //serverId对应的服务器挂掉后,强制定向到其他健康的服务器
    retries                 3              //三次连接失败则服务器不用
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s            //连接超时
    timeout client          1m             //客户端超时
    timeout server          1m             //服务器超时
    timeout http-keep-alive 10s
    timeout check           10s            //心跳检测
    maxconn                 600            //最大连接数

listen stats                               //配置haproxy状态页（用来查看的页面）
    mode http
    bind :8888
    stats enable
    stats hide-version                    //隐藏haproxy版本号
    stats uri     /haproxyadmin?stats     //一会用于打开状态页的uri
    stats realm   Haproxy\ Statistics     //输入账户密码时的提示文字
    stats auth    admin:admin             //用户名:密码

# MySQL 负载配置
listen proxy-mysql 
    bind 0.0.0.0:13306 # 监听端口
    mode tcp # 模式
    balance roundrobin # 负载均衡的方式，轮询（平均）方式
    option tcplog # 允许记录tcp 连接的状态和时间
    #option mysql-check user haproxy
    server MySQL1 192.168.117.139:3306 check weight 1 maxconn 2000
    server MySQL2 192.168.117.140:3306 check weight 1 maxconn 2000
    option tcpka # 是否允许向server和client发送keepalive</code></pre>

<!--block_code_end--><h4 id="toc_16" class="h16">启动 HAProxy</h4>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　重启 HAProxy </span>
</p>


<pre><code>[root@localhost ~]# systemctl restart haproxy</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　<strong>启动失败，查看错误信息如下：</strong></span>
</p>


<pre><code>[root@localhost ~]# tail -f /var/log/messages
Jul  7 05:36:20 localhost systemd: Started HAProxy Load Balancer.
Jul  7 05:36:20 localhost systemd: Starting HAProxy Load Balancer...
Jul  7 05:36:20 localhost haproxy-systemd-wrapper: [WARNING] 187/053620 (5022) : config : 'option forwardfor' ignored for proxy 'proxy-mysql' as it requires HTTP mode.
Jul  7 05:36:20 localhost haproxy-systemd-wrapper: [ALERT] 187/053620 (5022) : Starting proxy stats: cannot bind socket [0.0.0.0:8888]
Jul  7 05:36:20 localhost haproxy-systemd-wrapper: [ALERT] 187/053620 (5022) : Starting proxy proxy-mysql: cannot bind socket [0.0.0.0:13306]
Jul  7 05:36:20 localhost haproxy-systemd-wrapper: haproxy-systemd-wrapper: exit, haproxy RC=1
Jul  7 05:36:20 localhost systemd: haproxy.service: main process exited, code=exited, status=1/FAILURE
Jul  7 05:36:20 localhost systemd: Unit haproxy.service entered failed state.
Jul  7 05:36:20 localhost systemd: haproxy.service failed.</code></pre>

<!--block_code_end-->
<ul>
<li class="md_li"><span>关闭 <code>防火墙</code>、<code>SELinux</code> 再次尝试重启，成功。
</span></li>
</ul>

<pre><code>[root@localhost ~]# systemctl stop firewalld
[root@localhost ~]# setenforce 0
[root@localhost ~]# systemctl restart haproxy
[root@localhost ~]# ps -ef | grep haproxy
root       5044      1  0 05:37 ?        00:00:00 /usr/sbin/haproxy-systemd-wrapper -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid
haproxy    5045   5044  0 05:37 ?        00:00:00 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds
haproxy    5046   5045  0 05:37 ?        00:00:00 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds
root       5048   1146  0 05:37 pts/0    00:00:00 grep --color=auto haproxy</code></pre>

<!--block_code_end--><h4 id="toc_17" class="h16">查看负载情况</h4>

<ul>
<li class="md_li"><span>访问地址：http://192.168.117.139:8888/haproxyadmin?stats
</span></li>
</ul>

<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/60f0cd0ba38647ae9e84e8441b4bbe8b.png" alt="负载状态" title="" ></span>
</p>


<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　安装 HAProxy 的步骤在 <code>192.168.117.140</code> 上做相同步骤即可。</span>
</p>

</blockquote>
<h3 id="toc_18" class="h16">Keepalived 安装</h3>
<h4 id="toc_19" class="h16">安装</h4>

<pre><code>[root@localhost ~]# yum -y install keepalived</code></pre>

<!--block_code_end--><h4 id="toc_20" class="h16">配置</h4>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　配置文件路径：<code>/etc/keepalived/keepalived.conf</code></span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　配置 Keepalived</span>
</p>


<pre><code>! Configuration File for keepalived
#简单的头部，这里主要可以做邮件通知报警等的设置，此处就暂不配置了；
global_defs {
        notificationd LVS_DEVEL
}
#预先定义一个脚本，方便后面调用，也可以定义多个，方便选择；
vrrp_script chk_haproxy {
    script "/etc/keepalived/chk.sh"  #具体脚本路径
    interval 2  #脚本循环运行间隔
}
#VRRP虚拟路由冗余协议配置
vrrp_instance VI_1 {   #VI_1 是自定义的名称；
    state MASTER #MASTER表示是一台主设备，BACKUP表示为备用设备【我们这里因为设置为开启不抢占，所以都设置为备用】
    nopreempt      #开启不抢占
    interface ens33   #指定VIP需要绑定的物理网卡
    virtual_router_id 11   #VRID虚拟路由标识，也叫做分组名称，该组内的设备需要相同
    priority 120   #定义这台设备的优先级 1-254；开启了不抢占，所以此处优先级必须高于另一台

    advert_int 1   #生存检测时的组播信息发送间隔，组内一致
    authentication {    #设置验证信息，组内一致
        auth_type PASS   #有PASS 和 AH 两种，常用 PASS
        auth_pass asd    #密码
    }
    virtual_ipaddress {
        192.168.117.111    #指定VIP地址，组内一致，可以设置多个IP
    }
    track_script {    #使用在这个域中使用预先定义的脚本，上面定义的
        chk_haproxy   
    }

    notify_backup "systemctl restart haproxy"   #表示当切换到backup状态时,要执行的脚本
    notify_fault "systemctl stop haproxy"     #故障时执行的脚本
}</code></pre>

<!--block_code_end-->
<p class="md_block md_block_as_opening md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　几个点，说明下：</span>
</p>


<ul>
<li class="md_li"><span><strong>state：</strong>如果是主机的话，值要写成 <code>MASTER</code>，备机写成 <code>BACKUP</code>
</span></li>
<li class="md_li"><span><strong>interface：</strong>物理机网卡名称，我的这个虚拟机上的现有网卡名称是 <code>ens33</code>
</span></li>
<li class="md_li"><span><strong>priority：</strong> 定义这台设备的优先级 1-254；备机小于主机
</span></li>
<li class="md_li"><span><strong>virtual_ipaddress：</strong>指定的虚拟 IP，可以设置多个，但是一定要是在当前网段，否则设置了也无法访问。
</span></li>
</ul>
<h4 id="toc_21" class="h16">编写脚本文件</h4>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　脚本文件是为了检测 HAProxy 程序是否还在正常运行，两秒钟检测一次，如果程序已经挂掉，则把当前主 Keepalived 一同挂掉，这样就可以让备机接管 <code>VIP</code>（虚拟IP），达到高可用的目的。</span>
</p>


<pre><code>[root@localhost ~]# vim /etc/keepalived/chk.sh
#!/bin/bash
#
if [ $(ps -C haproxy --no-header | wc -l) -eq 0 ]; then
       systemctl stop keepalived
fi

[root@localhost ~]# chmod 777 /etc/keepalived/chk.sh</code></pre>

<!--block_code_end-->
<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　此处检测程序较为简单，比较保险的做法可以参考：多次检测负载的服务是否正常可接受访问，如多次访问失败则停止主 Keepalive。</span>
</p>

</blockquote>
<h4 id="toc_22" class="h16">启动 Keepalived</h4>

<pre><code>[root@localhost ~]# systemctl restart keepalived
[root@localhost ~]# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:15:37:e3 brd ff:ff:ff:ff:ff:ff
    inet 192.168.117.139/24 brd 192.168.117.255 scope global noprefixroute dynamic ens33
       valid_lft 1632sec preferred_lft 1632sec
    inet 192.168.117.111/32 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::fdf1:237c:2a96:81c6/64 scope link noprefixroute
       valid_lft forever preferred_lft forever</code></pre>

<!--block_code_end-->
<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_start md_line_end">　　可以看到，上方<code>ens33</code>网卡下有一个新增的 ip，<strong>inet 192.168.117.111/32 scope global ens33</strong></span>
</p>


<blockquote class="blockquote_lines_1">
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　安装 Keepalived 的步骤在 <code>192.168.117.140</code> 上做相同步骤即可。</span>
</p>

</blockquote>
<h1 id="toc_23" class="h16">测试</h1>
<h3 id="toc_24" class="h16">测试环境</h3>

<ul>
<li class="md_li"><span>Spring Boot
</span></li>
<li class="md_li"><span>spring-boot-starter-data-jpa
</span></li>
</ul>
<h3 id="toc_25" class="h16">配置项</h3>

<pre><code>spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://192.168.117.111:13306/aa?autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=UTF-8
    username: 你的用户名
    password: 你的密码</code></pre>

<!--block_code_end--><h3 id="toc_26" class="h16">测试伪代码</h3>

<pre><code>################# Controller
import com.lynchj.mysqlzhuzhucopy.component.MyConstants;
import com.lynchj.mysqlzhuzhucopy.entity.User;
import com.lynchj.mysqlzhuzhucopy.service.UserServiceInter;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;
import java.math.BigDecimal;
import java.util.Date;

@RestController
@RequestMapping("/user")
@Slf4j
public class UserController {

    @Resource
    private UserServiceInter userServiceInter;

    private static Integer count = 0;

    @RequestMapping("/saveUserTwo")
    public User saveUserTwo() {

        System.err.println("当前第 [" + ++count + "] 条数据" );
        
        User user = new User();
        user.setId(MyConstants.idWorkerUtil.nextId() + "");
        user.setCreateTime(new Date());
        user.setName("吼吼吼");
        user.setBirthday(new Date());
        user.setHeight(new BigDecimal("1.74"));

        return userServiceInter.saveUser(user);

    }

}

################# Service
import com.lynchj.mysqlzhuzhucopy.dao.UserDaoInter;
import com.lynchj.mysqlzhuzhucopy.entity.User;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

@Service
@Slf4j
public class UserService implements UserServiceInter {

    @Resource
    private UserDaoInter userDaoInter;

    @Override
    public User saveUser(User user) {

        return userDaoInter.save(user);

    }

}

################# Dao
public interface UserDaoInter extends JpaRepository&lt;User, String&gt; {

    @Override
    User save(User user);

}

################# entity
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Entity;
import javax.persistence.Id;
import java.math.BigDecimal;
import java.util.Date;

@Data
@NoArgsConstructor
@AllArgsConstructor
@Entity
public class User {

    @Id
    private String id;

    private Date createTime;

    private String name;

    private Integer age;

    private Date birthday;

    private BigDecimal height;

}</code></pre>

<!--block_code_end--><h3 id="toc_27" class="h16">测试</h3>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　我这里是用 JMeter 进行测试，以 <code>每秒两条线程请求</code> 的频率进行存储数据，中间会手动杀死主设备上的 HAProxy，观察 Keepalived 的 VIP 是否已经<code>飘到</code>备用设备上并且程序是否会自动切换。</span>
</p>


<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/9df8e3ffea504bfbb4521154ef35534e.png" alt="JMeter 测试" title="" ></span>
</p>


<ul>
<li class="md_li"><span>观察控制台打印：
</span></li>
</ul>

<p class="md_block">
    <span class="md_line md_line_dom_embed md_line_with_image md_line_start md_line_end"><img class="md_compiled " src="http://img.lynchj.com/400be3c6048f4882abd9f09418173985.png" alt="控制台输出结果" title="" ></span>
</p>


<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　中间手动 kill 掉了主机上的 HAProxy，出现了错误信息呢，在之后又继续新增操作。</span>
</p>


<ul>
<li class="md_li"><span>此时查看备机的 IP 信息如下：
</span></li>
</ul>

<pre><code>[root@localhost ~]# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:83:3b:07 brd ff:ff:ff:ff:ff:ff
    inet 192.168.117.140/24 brd 192.168.117.255 scope global noprefixroute dynamic ens33
       valid_lft 1505sec preferred_lft 1505sec
    inet 192.168.117.111/32 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::f6e7:5569:d37:4950/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
    inet6 fe80::fdf1:237c:2a96:81c6/64 scope link tentative noprefixroute dadfailed
       valid_lft forever preferred_lft forever</code></pre>

<!--block_code_end-->
<blockquote class="blockquote_lines_2">
<p class="md_block">
    <span class="md_line md_line_start">Over<br /></span>
    <span class="md_line md_line_dom_embed md_line_end"><!--blockquote--></span>
</p>

</blockquote>
            </div>
        </div>
        

    </div>

</div>





<div class="sidebar_clicker click_to_close_sidebar">
    <span class="bar"></span>
</div>




<script type="text/javascript" src="../asset/fit/jquery.js"></script>
<script type="text/javascript" src="../asset/fit/sidebar/auto_sidebar.js"></script>





<script>
    run_sidebar("left", 'sidebar', 270, "show");

    $(document).ready(function(){
        var sidebar = $('.index_body'); var current = $('.index_body .active');
        if (sidebar.length && current.length){ sidebar.scrollTop(current.offset().top - sidebar.height()/2 + 100);}
    })
</script>



</body>

</html>