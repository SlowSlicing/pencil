Linux
RHEL,CentOS,文件系统
&emsp;&emsp;用户在硬件存储设备中执行的文件建立、写入、读取、修改、转存与控制等操作都是依靠文件系统来完成的。文件系统的作用是合理规划硬盘，以保证用户正常的使用需求。Linux系统支持数十种的文件系统，而最常见的文件系统如下所示：

&emsp;&emsp;**1、Ext3：**是一款日志文件系统，能够在系统异常宕机时`避免文件系统资料丢失`，并能自动修复数据的不一致与错误。然而，当硬盘容量较大时，所需的修复时间也会很长，而且也`不能百分之百`地保证资料不会丢失。它会把整个磁盘的每个写入动作的细节都预先记录下来，以便在发生异常宕机后能回溯追踪到被中断的部分，然后尝试进行修复。
&emsp;&emsp;**2、Ext4:**`Ext3 的改进版本`，作为RHEL 6 系统中的默认文件管理系统，它支持的存储容量高达
1EB（1EB=1,073,741,824GB），且能够有无限多的子目录。另外，Ext4 文件系统能够批量分配block 块，从而极大地提高了读写效率。
&emsp;&emsp;**3、XFS：**是一种高性能的日志文件系统，而且是RHEL 7 中默认的文件管理系统，它的优势在发生意外宕机后尤其明显，即可以`快速地恢复可能被破坏的文件`，而且强大的日志功能只用花费`极低的计算和存储性能`。并且它最大可支持的存储容量为`18EB`，这几乎满足了所有需求。

&emsp;&emsp;RHEL 7 系统中一个比较大的变化就是使用了`XFS 作为文件系统`，这不同于RHEL 6 使用的Ext4。从红帽公司官方发布的说明来看，这确实是一个不小的进步，但是在实测中发现并不完全属实。因为单纯就测试一款文件系统的`读取`性能来说，到底要读取多少个文件，每个文件的大小是多少，读取文件时的CPU、内存等系统资源的占用率如何，以及不同的硬件配置是否会有不同的影响，因此在充分考虑到这些不确定因素后，实在不敢直接照抄红帽官方的介绍。我个人认为XFS 虽然在性能方面比Ext4 有所提升，但绝不是压倒性的，因此XFS 文件系统最卓越的亮点应该当属可支持高达18EB 的存储容量吧。

&emsp;&emsp;就像拿到了一张未裁切的完整纸张那样，我们首先要进行裁切以方便使用，然后在裁切后的纸张上画格以便能书写工整。在拿到了一块新的硬盘存储设备后，也需要先分区，然后再格式化文件系统，最后才能挂载并正常使用。硬盘的分区操作取决于您的需求和硬盘大小；您也可以选择不进行分区，但是必须对硬盘进行格式化处理。接下来简单地说一下硬盘在格式化后发生的事情。

&emsp;&emsp;日常在硬盘需要保存的数据实在太多了，因此Linux 系统中有一个名为`super block` 的`硬盘地图`。Linux 并不是把文件内容直接写入到这个`硬盘地图`里面，而是在里面记录着整个文件系统的信息。因为如果把所有的文件内容都写入到这里面，它的体积将变得非常大，而且文件内容的查询与写入速度也会变得很慢。Linux 只是把每个文件的权限与属性记录在`inode 中`，而且每个文件占用一个独立的`inode 表格`，该表格的大小默认为`128 字节`，里面记录着如下信息：

&emsp;&emsp;**该文件的访问权限（read、write、execute）；**
&emsp;&emsp;**该文件的所有者与所属组（owner、group）；**
&emsp;&emsp;**该文件的大小（size）；**
&emsp;&emsp;**该文件的创建或内容修改时间（ctime）；**
&emsp;&emsp;**该文件的最后一次访问时间（atime）；**
&emsp;&emsp;**该文件的修改时间（mtime）；**
&emsp;&emsp;**文件的特殊权限（SUID、SGID、SBIT）；**
&emsp;&emsp;**该文件的真实数据地址（point）。**

&emsp;&emsp;而文件的实际内容则保存在`block 块`中（大小可以是1KB、2KB 或4KB），一个inode 的默认大小仅为128B（Ext3），记录一个block 则消耗4B。当文件的inode 被写满后，Linux 系统会自动分配出一个block 块，专门用于像inode 那样记录其他block 块的信息，这样把各个block 块的内容串到一起，就能够让用户读到完整的文件内容了。对于存储文件内容的block块，有下面两种常见情况（以4KB 的block 大小为例进行说明）。

&emsp;&emsp;**情况1：**文件很小（1KB），但依然会占用一个block，因此会潜在地浪费3KB。
&emsp;&emsp;**情况2：**文件很大（5KB），那么会占用两个block（5KB-4KB 后剩下的1KB 也要占用一个block）。

&emsp;&emsp;计算机系统在发展过程中产生了众多的文件系统，为了使用户在读取或写入文件时不用关心底层的硬盘结构，Linux 内核中的软件层为用户程序提供了一个`VFS`（Virtual File System，虚拟文件系统）接口，这样用户实际上在操作文件时就是统一对这个虚拟文件系统进行操作了。下图所示为`VFS 的架构示意图`。从中可见，实际文件系统在VFS 下隐藏了自己的特性和细节，这样用户在日常使用时会觉得`文件系统都是一样的`，也就可以随意使用各种命令在任何文件系统中进行各种操作了（比如使用cp 命令来复制文件）。

![VFS 的架构示意图](http://img.lynchj.com/29966148ac004f128d5a9ab61f0ca5cf.png)

