<!DOCTYPE html>
<html>
<head>
    <title>goroutine</title>

    <meta charset="UTF-8"/>

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>

    <meta name="HandheldFriendly" content="true"/>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>

    <link href="../asset/fit/basic_markdown.css" type="text/css" rel="stylesheet"/>
    <link href="../asset/fit/style.css" type="text/css" rel="stylesheet"/>
    <link href="../asset/fit/sidebar/auto_sidebar.css" type="text/css" rel="stylesheet"/>

    <style type="text/css">
        body {margin-left: 270px}
        .index {width: 270px}

        
            span.md_line{margin-bottom:0.5em; display:block; line-height:1.89}
            .md_line br{ display: none;}
            
    </style>

    <script>
        var flowchat_options = {
            'x': 0, 'y': 0, 'line-width': 1, 'line-length': 50, 'text-margin': 10, 'font-size': 13,
            'font-color': '#3c3c3c', 'line-color': '#666666', 'element-color': '#666666', 'fill': 'transparent',
            'yes-text': 'yes', 'no-text': 'no', 'arrow-end': 'block', 'class': 'flowchart', 'scale': 1,
            'symbols': { 'start': {}, 'end': {}, 'condition': {}, 'inputoutput': {}, 'operation': {}, 'subroutine': {}}
        }
    </script>
    <script type="text/javascript" src="../asset/other/raphael-min.js"></script>
    <script type="text/javascript" src="../asset/other/flowchart.js"></script>
    <script type="text/javascript" src="../asset/other/echarts.min.js"></script>

    <link href="../asset/other/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script type="text/javascript" src="../asset/other/mermaid/mermaid.min.js"></script>


</head>

<body>





<div class="sidebar">
    <div class="sidebar_body">
        <div class="index">
            <ul class="index_body">
                <li class="title">
                    <a href="../index.html">大漠知秋的小秘密</a>
                </li>
                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>1</b> Docker CE</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker Compose 使用.html" ><b>1.1</b> Docker Compose 使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker Dockerfile 定制镜像.html" ><b>1.2</b> Docker Dockerfile 定制镜像</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 仓库.html" ><b>1.3</b> Docker Hub</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 单台宿主机多应用部署.html" ><b>1.4</b> 实验环境</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 基本概念.html" ><b>1.5</b> Docker 基本概念</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 基本网络功能.html" ><b>1.6</b> Docker 基本网络功能</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 多台宿主机多应用部署.html" ><b>1.7</b> Docker 多台宿主机多应用部署</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 安装.html" ><b>1.8</b> Docker 安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 容器.html" ><b>1.9</b> Docker 容器</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 数据管理.html" ><b>1.10</b> Docker 数据管理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 私有仓库.html" ><b>1.11</b> 安装运行 docker-registry</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 简介.html" ><b>1.12</b> Docker 简介</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 网络深入理解.html" ><b>1.13</b> Docker 网络深入理解</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 镜像.html" ><b>1.14</b> Docker 镜像</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/Docker 镜像加速器.html" ><b>1.15</b> Docker 镜像加速器</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Docker CE/问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口.html" ><b>1.16</b> 问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>2</b> Elasticsearch</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Elasticsearch/问题 - Elasticsearch 问题收集.html" ><b>2.1</b> 问题 - Elasticsearch 问题收集</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>3</b> FastDFS</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../FastDFS/FastDFS 单机安装.html" ><b>3.1</b> FastDFS 单机安装</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>4</b> Git</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Git/GitHub 上同步 Fork 的代码.html" ><b>4.1</b> GitHub 上同步 Fork 的代码</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>5</b> GitLab</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/Docker GitLab SSH 坑.html" ><b>5.1</b> Docker GitLab SSH 坑</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/Docker 安装 GitLab.html" ><b>5.2</b> Docker 安装 GitLab</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/如何查看 GitLab 版本号.html" ><b>5.3</b> 如何查看 GitLab 版本号</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../GitLab/问题 - GitLab repositories 文件夹权限异常.html" ><b>5.4</b> 问题 - GitLab repositories 文件夹权限异常</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>6</b> Golang</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/channel.html" ><b>6.1</b> channel</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item active">
        
        
        <a class="link_in_site" href="../Golang/goroutine.html" ><b>6.2</b> goroutine</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/函数.html" ><b>6.3</b> 函数</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/匿名函数与闭包.html" ><b>6.4</b> 匿名函数与闭包</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/变量.html" ><b>6.5</b> 变量</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/基础环境安装.html" ><b>6.6</b> 基础环境安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/常量.html" ><b>6.7</b> 常量</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/并发 - 同步.html" ><b>6.8</b> 并发 - 同步</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/数据类型.html" ><b>6.9</b> 数据类型</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/流程控制.html" ><b>6.10</b> 流程控制</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/语言特性.html" ><b>6.11</b> 语言特性</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/错误处理.html" ><b>6.12</b> 错误处理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/问题 - 出让时间片.html" ><b>6.13</b> 问题 - 出让时间片</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/问题 - 多核并行化.html" ><b>6.14</b> 问题 - 多核并行化</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 使用组合和定义别名.html" ><b>6.15</b> 面向对象 - 使用组合和定义别名</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 接口.html" ><b>6.16</b> 面向对象 - 接口</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 类型系统.html" ><b>6.17</b> 面向对象 - 类型系统</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面向对象 - 结构体.html" ><b>6.18</b> 面向对象 - 结构体</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Golang/面型对象 - 包和封装.html" ><b>6.19</b> 命名规范</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>7</b> Http Client 4.5.2</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Http Client 4.5.2/为GET和POST请求添加请求参数和请求头.html" ><b>7.1</b> 为GET和POST请求添加请求参数和请求头</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Http Client 4.5.2/入门.html" ><b>7.2</b> 入门</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>8</b> Java</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Java/使用 Undertow 替换掉 Tomcat.html" ><b>8.1</b> 使用 Undertow 替换掉 Tomcat</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Java/编写高质量代码 - Java.html" ><b>8.2</b> 编写高质量代码 - Java</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Java/问题 - Spring Boot 以流的方式读取配置文件.html" ><b>8.3</b> 问题 - Spring Boot 以流的方式读取配置文件</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>9</b> Kubernetes</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/Kubernetes 1.14 kubeadm 集群安装.html" ><b>9.1</b> Kubernetes 1.14 kubeadm 集群安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/Kubernetes 1.14 开启 IPVS.html" ><b>9.2</b> Kubernetes 1.14 开启 IPVS</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/Kubernetes 1.6.1 kubeadm 集群安装.html" ><b>9.3</b> Kubernetes 1.6.1 kubeadm 集群安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/kubeadm 安装 k8s 集群.html" ><b>9.4</b> kubeadm 安装 k8s 集群</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/《Kubernetes权威指南》1.3案例部署及问题解决.html" ><b>9.5</b> 《Kubernetes权威指南》1.3案例部署及问题解决</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/安装 Dashboard.html" ><b>9.6</b> 安装 Dashboard</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Kubernetes/问题 - kubectl create 一直处于 ContainerCreating 状态.html" ><b>9.7</b> 问题 - kubectl create 一直处于 ContainerCreating 状态</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>10</b> Linux</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/CentOS 升级内核.html" ><b>10.1</b> CentOS 升级内核</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/Firewalld 详解.html" ><b>10.2</b> Firewalld 详解</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/RHEL 6 和 RHEL 7 的一些区别.html" ><b>10.3</b> RHEL 6 和 RHEL 7 的一些区别</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/RHEL 7 常用命令.html" ><b>10.4</b> RHEL 7 常用命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/RHEL 的目录结构.html" ><b>10.5</b> RHEL 的目录结构</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/SWAP交换分区（虚拟内存）.html" ><b>10.6</b> SWAP交换分区（虚拟内存）</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/SWAP虚拟内存配置.html" ><b>10.7</b> SWAP虚拟内存配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/Shell 脚本入门.html" ><b>10.8</b> Shell 脚本入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/curl 命令.html" ><b>10.9</b> curl 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/find 命令的使用.html" ><b>10.10</b> 常用命令组合</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/tar 命令.html" ><b>10.11</b> 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/一次服务器中病毒挖矿事件处理.html" ><b>10.12</b> 一次服务器中病毒挖矿事件处理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/使用 systemd 开机启动.html" ><b>10.13</b> 使用 systemd 开机启动</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/常用 rpm 命令.html" ><b>10.14</b> 常用 rpm 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/常用 yum 命令.html" ><b>10.15</b> 常用 yum 命令</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/常用的转义字符.html" ><b>10.16</b> 常用的转义字符</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/挂载硬件设备.html" ><b>10.17</b> 挂载硬件设备</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/文件权限与归属.html" ><b>10.18</b> 文件权限与归属</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/文件系统与数据资料.html" ><b>10.19</b> 文件系统与数据资料</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/添加硬盘设备.html" ><b>10.20</b> 添加硬盘设备</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/物理设备的命名规则.html" ><b>10.21</b> 物理设备的命名规则</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/环境变量和命令的执行步骤.html" ><b>10.22</b> 环境变量和命令的执行步骤</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/用户管理.html" ><b>10.23</b> 用户管理</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/磁盘容量配额.html" ><b>10.24</b> 磁盘容量配额</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/管道命令符.html" ><b>10.25</b> 管道命令符</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/计划任务服务程序（定时任务）.html" ><b>10.26</b> 计划任务服务程序（定时任务）</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/软硬方式链接（快捷方式）.html" ><b>10.27</b> 软硬方式链接（快捷方式）</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/输入输出重定向.html" ><b>10.28</b> 输入输出重定向</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口.html" ><b>10.29</b> 问题 - Linux 下 Docker 端口映射到宿主机后 外部无法访问对应宿主机端口</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/问题 - Linux 项目输出日志中文变问号.html" ><b>10.30</b> 问题 - Linux 项目输出日志中文变问号</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/防火墙 - firewalld.html" ><b>10.31</b> 防火墙 - firewalld</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Linux/防火墙 - iptables.html" ><b>10.32</b> 防火墙 - iptables</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>11</b> Maven</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Maven/Docker 安装 Maven 私服 Nexus 3.12.1.html" ><b>11.1</b> Docker 安装 Maven 私服 Nexus 3.12.1</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>12</b> MySQL</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/ContOS7.4 + MySQL5.6.40安装.html" ><b>12.1</b> ContOS7.4 + MySQL5.6.40安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/Galera Cluster For MySQL.html" ><b>12.2</b> Galera Cluster For MySQL</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/MySQL Yum 存储库安装.html" ><b>12.3</b> MySQL Yum 存储库安装</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/MySQL 主主复制 高可用负载均衡集群.html" ><b>12.4</b> MySQL 主主复制 高可用负载均衡集群</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../MySQL/MySQL 用户管理及授权.html" ><b>12.5</b> MySQL 用户管理及授权</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>13</b> Nginx</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/Nginx 处理跨域问题.html" ><b>13.1</b> Nginx 处理跨域问题</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/Nginx 重定向 HTTP 到 HTTPS.html" ><b>13.2</b> Nginx 重定向 HTTP 到 HTTPS</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/在已安装的 Nginx 上追加 module.html" ><b>13.3</b> 在已安装的 Nginx 上追加 module</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Nginx/问题 - .斜杠Configure darwin64-x86_64-cc.html" ><b>13.4</b> 问题 - .斜杠Configure darwin64-x86_64-cc</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>14</b> Rabbit MQ</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Rabbit MQ/RabbitMQ + Keepalived + HAProxy 高可用镜像集群.html" ><b>14.1</b> RabbitMQ + Keepalived + HAProxy 高可用镜像集群</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>15</b> Redis</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Redis/Redis Cluster 从零安装并详解.html" ><b>15.1</b> Redis Cluster 从零安装并详解</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>16</b> Spring</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring/使用 ApplicationContextAware 获取 Spring 管理 Bean.html" ><b>16.1</b> 使用ApplicationContextAware接口</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>17</b> Spring Boot</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 制作一个自己的 Starter.html" ><b>17.1</b> Spring Boot 制作一个自己的 Starter</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 在 Redis Cluster RedisTemplate 基础上做缓存.html" ><b>17.2</b> Spring Boot 在 Redis Cluster RedisTemplate 基础上做缓存</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 结合 Redis Cluster RedisTemplate.html" ><b>17.3</b> Spring Boot 结合 Redis Cluster RedisTemplate</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/Spring Boot 结合 Redis Cluster 简单使用.html" ><b>17.4</b> Spring Boot 结合 Redis Cluster 简单使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/使用 Undertow 替换掉 Tomcat.html" ><b>17.5</b> 使用 Undertow 替换掉 Tomcat</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Boot/问题 - Spring Boot 以流的方式读取配置文件.html" ><b>17.6</b> 问题 - Spring Boot 以流的方式读取配置文件</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>18</b> Spring Cloud Finchley.RELEASE</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Client 自动刷新.html" ><b>18.1</b> Config Client 自动刷新</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server refresh 端点.html" ><b>18.2</b> Config Server refresh 端点</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 入门.html" ><b>18.3</b> Config Server 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 安全.html" ><b>18.4</b> Config Server 安全</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 本地覆盖远程.html" ><b>18.5</b> Config Server 本地覆盖远程</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Config Server 高可用.html" ><b>18.6</b> Config Server 高可用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureak 开启 HTTPS.html" ><b>18.7</b> Eureak 开启 HTTPS</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka Server REST API.html" ><b>18.8</b> Eureka Server REST API</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka Server 高可用.html" ><b>18.9</b> Eureka Server 高可用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 入门.html" ><b>18.10</b> Eureka 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 参数调优.html" ><b>18.11</b> Eureka 参数调优</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 常见故障.html" ><b>18.12</b> Eureka 常见故障</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 开启 HTTP Basic 认证.html" ><b>18.13</b> Eureka 开启 HTTP Basic 认证</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Eureka 的设计理念.html" ><b>18.14</b> 概述</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client Logger Configuration.html" ><b>18.15</b> Feign Client Logger Configuration</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client Upload File.html" ><b>18.16</b> Feign Client Upload File</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client 第一次请求超时.html" ><b>18.17</b> Feign Client 第一次请求超时</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign Client 超时配置.html" ><b>18.18</b> Feign Client 超时配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign GET 多参数传递.html" ><b>18.19</b> Feign GET 多参数传递</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign 基本使用.html" ><b>18.20</b> Feign 基本使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign 开启 GZIP 压缩.html" ><b>18.21</b> 配置文件新增</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Feign 默认 Client 替换.html" ><b>18.22</b> Feign 默认 Client 替换</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix Dashboard.html" ><b>18.23</b> Hystrix Dashboard</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix Turbine.html" ><b>18.24</b> Hystrix Turbine</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix 入门.html" ><b>18.25</b> Hystrix 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix 异常处理机制.html" ><b>18.26</b> Hystrix 异常处理机制</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Hystrix 配置说明.html" ><b>18.27</b> Hystrix 配置说明</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/OpenResty + Lua 动态增加 Zuul 节点.html" ><b>18.28</b> OpenResty + Lua 动态增加 Zuul 节点</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 入门.html" ><b>18.29</b> Ribbon 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 脱离 Eureka 进行负载.html" ><b>18.30</b> Ribbon 脱离 Eureka 进行负载</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 负载均衡策略配置.html" ><b>18.31</b> Ribbon 负载均衡策略配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 超时与重试.html" ><b>18.32</b> Ribbon 超时与重试</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Ribbon 饥饿加载.html" ><b>18.33</b> Ribbon 饥饿加载</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Spring Boot Admin 使用.html" ><b>18.34</b> Spring Boot Admin 使用</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul Filter.html" ><b>18.35</b> Zuul Filter</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul serviceId 映射与 url 映射超时配置的不同.html" ><b>18.36</b> Zuul serviceId 映射与 url 映射超时配置的不同</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 上传文件.html" ><b>18.37</b> Zuul 上传文件</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 不向后端服务传递指定 Headers.html" ><b>18.38</b> Zuul 不向后端服务传递指定 Headers</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 使用 OKHttp 替换 HttpClient.html" ><b>18.39</b> Zuul 使用 OKHttp 替换 HttpClient</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 修改请求体内容.html" ><b>18.40</b> Zuul 修改请求体内容</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 入门.html" ><b>18.41</b> Zuul 入门</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 基于 Eureka 元数据的弧度发布.html" ><b>18.42</b> Zuul 基于 Eureka 元数据的弧度发布</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 对 Hystrix 的线程隔离模式选择.html" ><b>18.43</b> Zuul 对 Hystrix 的线程隔离模式选择</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 屏蔽服务和指定路径.html" ><b>18.44</b> Zuul 屏蔽服务和指定路径</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 添加 Header.html" ><b>18.45</b> Zuul 添加 Header</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 路由前缀.html" ><b>18.46</b> Zuul 路由前缀</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 路由配置.html" ><b>18.47</b> Zuul 路由配置</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 重定向问题.html" ><b>18.48</b> Zuul 重定向问题</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/Zuul 重试.html" ><b>18.49</b> Zuul 重试</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../Spring Cloud Finchley.RELEASE/使用 Undertow 替换掉 Tomcat.html" ><b>18.50</b> 使用 Undertow 替换掉 Tomcat</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>19</b> 吉他</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../吉他/左右手指说明.html" ><b>19.1</b> 左右手指说明</a>
        
    </li>

                                    
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../吉他/调音.html" ><b>19.2</b> 初识定音</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
                    
                    
    
    <li class="item">
        
        
        <a class="link_in_site" href="#" ><b>20</b> 开发软件问题</a>
        
            
                        
                            <ul class="articles">
                                
                                    
                                        
    
    <li class="item">
        
        
        <a class="link_in_site" href="../开发软件问题/问题 - iTerm2 中文输出显示问号.html" ><b>20.1</b> 问题 - iTerm2 中文输出显示问号</a>
        
    </li>

                                    
                                
                            </ul>
                        
                    
        
    </li>


                
            </ul>

        </div>

    </div>
</div>

<div class="content">
    <div class="content_body">
        <h2 class="post_title">
            goroutine
        </h2>
        <div class="post_body">
            <div class="markdown">
                <div class="toc_container">
<div class="toc"><ul>
<li>
<a href="#toc_0">并发概念</a>
</li>
<li>
<a href="#toc_1">协程</a>
</li>
<li>
<a href="#toc_2">goroutine</a>
</li>
<li>
<a href="#toc_3">并发通信</a>
</li>
</ul>
</div>
</div><h1 id="toc_0" class="h16 md_first_h">并发概念</h1>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　回到在 Windows 和 Linux 出现之前的古老年代，程序员在开发程序时并没有并发的概念，因为命令式程序设计语言是以串行为基础的，程序会顺序执行每一条指令，整个程序只有一个执行上下文，即一个调用栈，一个堆。并发则意味着程序在运行时有多个执行上下文，对应着多个调用栈。我们知道每一个进程在运行时，都有自己的调用栈和堆，有一个完整的上下文，而操作系统在调度进程的时候，会保存被调度进程的上下文环境，等该进程获得时间片后，再恢复该进程的上下文到系统中。</span>
</p>


<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　从整个操作系统层面来说，多个进程是可以并发的，那么并发的价值何在？下面我们先看以下几种场景。</span>
</p>


<ul>
<li class="md_li"><span>一方面我们需要灵敏响应的图形用户界面，一方面程序还需要执行大量的运算或者 IO 密集操作，而我们需要让界面响应与运算同时执行。
</span></li>
<li class="md_li"><span>当我们的 Web 服务器面对大量用户请求时，需要有更多的<strong>Web 服务器工作单元</strong>来分别响应用户。
</span></li>
<li class="md_li"><span>我们的事务处于分布式环境上，相同的工作单元在不同的计算机上处理着被分片的数据。
</span></li>
<li class="md_li"><span>计算机的 CPU 从单内核（core）向多内核发展，而我们的程序都是串行的，计算机硬件的能力没有得到发挥。
</span></li>
<li class="md_li"><span>我们的程序因为 IO 操作被阻塞，整个程序处于停滞状态，其他 IO 无关的任务无法执行。
</span></li>
</ul>

<p class="md_block md_block_as_opening md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　从以上几个例子可以看到，串行程序在很多场景下无法满足我们的要求。下面归纳了并发程序的几条优点，可以发现并发的势在必行：</span>
</p>


<ul>
<li class="md_li"><span>并发能更客观地表现问题模型；
</span></li>
<li class="md_li"><span>并发可以充分利用 CPU 核心的优势，提高程序的执行效率；
</span></li>
<li class="md_li"><span>并发能充分利用 CPU 与其他硬件设备固有的异步性。
</span></li>
</ul>

<p class="md_block  md_has_block_below md_has_block_below_ul">
    <span class="md_line md_line_start md_line_end">　　现在我们已经意识到并发的好处了，那么到底有哪些方式可以实现并发执行呢？就目前而言，并发包含以下几种主流的实现模型。</span>
</p>


<ul>
<li class="md_li"><span>多进程。多进程是在操作系统层面进行并发的基本模式。同时也是开销最大的模式。在 Linux 平台上，很多工具链正是采用这种模式在工作。比如某个 Web 服务器，它会有专门的进程负责网络端口的监听和链接管理，还会有专门的进程负责事务和运算。这种方法的好处在于简单、进程间互不影响，坏处在于系统开销大，因为所有的进程都是由内核管理的。
</span></li>
<li class="md_li"><span>多线程。多线程在大部分操作系统上都属于系统层面的并发模式，也是我们使用最多的最有效的一种模式。目前，我们所见的几乎所有工具链都会使用这种模式。它比多进程的开销小很多，但是其开销依旧比较大，且在高并发模式下，效率会有影响。
</span></li>
<li class="md_li"><span>基于回调的非阻塞/异步 IO。这种架构的诞生实际上来源于多线程模式的危机。在很多高并发服务器开发实践中，使用多线程模式会很快耗尽服务器的内存和 CPU 资源。而这种模式通过事件驱动的方式使用异步 IO，使服务器持续运转，且尽可能地少用线程，降低开销，它目前在 Node.js 中得到了很好的实践。但是使用这种模式，编程比多线程要复杂，因为它把流程做了分割，对于问题本身的反应不够自然。
</span></li>
<li class="md_li"><span>协程。协程（Coroutine）本质上是一种用户态线程，不需要操作系统来进行抢占式调度，且在真正的实现中寄存于线程中，因此，系统开销极小，可以有效提高线程的任务并发性，而避免多线程的缺点。使用协程的优点是编程简单，结构清晰；缺点是需要语言的支持，如果不支持，则需要用户在程序中自行实现调度器。目前，原生支持协程的语言还很少。
</span></li>
</ul>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　接下来先诠释一下传统并发模型的缺陷，之后再所说 goroutine 并发模型是如何逐一解决这些缺陷的。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　人的思维模式可以认为是串行的，而且串行的事务具有确定性。线程类并发模式在原先的确定性中引入了不确定性，这种不确定性给程序的行为带来了意外和危害，也让程序变得不可控。线程之间通信只能采用共享内存的方式。为了保证共享内存的有效性，我们采取了很多措施，比如加锁等，来避免死锁或资源竞争。实践证明，我们很难面面俱到，往往会在工程中遇到各种奇怪的故障和问题。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　我们可以将之前的线程加共享内存的方式归纳为<code>共享内存系统</code>，虽然共享内存系统是一种有效的并发模式，但它也暴露了众多使用上的问题。计算机科学家们在近40年的研究中又产生了一种新的系统模型，称为<code>消息传递系统</code>。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　对线程间共享状态的各种操作都被封装在线程之间传递的消息中，这通常要求：发送消息时对状态进行复制，并且在消息传递的边界上交出这个状态的所有权。从逻辑上来看，这个操作与共享内存系统中执行的原子更新操作相同，但从物理上来看则非常不同。由于需要执行复制操作，所以大多数消息传递的实现在性能上并不优越，但线程中的状态管理工作通常会变得更为简单。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　最早被广泛应用的消息传递系统是由 C. A. R. Hoare 在他的 Communicating Sequential Processes 中提出的。在 CSP 系统中，所有的并发操作都是通过独立线程以异步运行的方式来实现的。这些线程必须通过在彼此之间发送消息，从而向另一个线程请求信息或者将信息提供给另一个线程。使用类似 CSP 的系统将提高编程的抽象级别。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　随着时间的推移，一些语言开始完善消息传递系统，并以此为核心支持并发，比如 Erlang。</span>
</p>

<h1 id="toc_1" class="h16">协程</h1>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　执行体是个抽象的概念，在操作系统层面有多个概念与之对应，比如操作系统自己掌管的进程（process）、进程内的线程（thread）以及进程内的协程（coroutine，也叫<code>轻量级线程</code>）。<strong>与传统的系统级线程和进程相比，协程的最大优势在于其<code>轻量级</code>，可以轻松创建上百万个而不会导致系统资源衰竭，而线程和进程通常最多也不能超过1万个。这也是协程也叫轻量级线程的原因。</strong></span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　多数语言在语法层面并不直接支持协程，而是通过库的方式支持，但用库的方式支持的功能也并不完整，比如仅仅提供轻量级线程的创建、销毁与切换等能力。如果在这样的轻量级线程中调用一个同步 IO 操作，比如网络通信、本地文件读写，都会阻塞其他的并发执行轻量级线程，从而无法真正达到轻量级线程本身期望达到的目标。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　Go 语言在语言级别支持轻量级线程，叫 <code>goroutine</code>。Go 语言标准库提供的所有系统调用操作（当然也包括所有同步 IO 操作），都会出让 CPU 给其他 goroutine。这让事情变得非常简单，让轻量级线程的切换管理不依赖于系统的线程和进程，也不依赖于 CPU 的核心数量。</span>
</p>

<h1 id="toc_2" class="h16">goroutine</h1>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　goroutine是 Go 语言中的轻量级线程实现，由 Go 运行时（runtime）管理。你将会发现，它的使用出人意料得简单。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　假设我们需要实现一个函数 Add()，它把两个参数相加，并将结果打印到屏幕上，具体代码如下：</span>
</p>


<pre><code>func Add(x, y int) {
    z := x + y
    fmt.Println(z)
}</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　那么，如何让这个函数并发执行呢?具体代码如下：</span>
</p>


<pre><code>go Add(1, 1)</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　是不是很简单?</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　你应该已经猜到，<code>go</code> 这个单词是关键。与普通的函数调用相比，这也是唯一的区别。的确，go 是 Go 语言中最重要的关键字，这一点从 Go 语言本身的命名即可看出。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　在一个函数调用前加上 go 关键字，这次调用就会在一个新的 goroutine 中并发执行。当被调用的函数返回时，这个 goroutine 也自动结束了。需要注意的是，<strong>如果这个函数有返回值，那么这个返回值会被丢弃</strong>。</span>
</p>


<pre><code>package main

import "fmt"

func Add(x, y int) {
    z := x + y
    fmt.Println(z)
}

func main() {
    for i := 0; i &lt; 10; i++ {
        go Add(i, i)
    }
}</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　在上面的代码里，在一个 for 循环中调用了10次 Add() 函数，它们是并发执行的。可是当你编译执行了上面的代码，就会发现一些奇怪的现象：</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　“什么？！屏幕上什么都没有，程序没有正常工作！”</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　是什么原因呢？明明调用了10次 Add()，应该有10次屏幕输出才对。要解释这个现象，就涉及 Go 语言的程序执行机制了。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　Go 程序从初始化 main package 并执行 main() 函数开始，当 main() 函数返回时，程序退出，且程序并不等待其他 goroutine（非主 goroutine）结束。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　对于上面的例子，主函数启动了10个 goroutine，然后返回，这时程序就退出了，而被启动的执行 Add(i, i) 的 goroutine 没有来得及执行，所以程序没有任何输出。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　OK，问题找到了，怎么解决呢？提到这一点，估计写过多线程程序的读者就已经恍然大悟，并且摩拳擦掌地准备使用类似 WaitForSingleObject、sleep 之类的调用，或者写个自己很拿手的忙等待或者稍微先进一些的 sleep 循环等待来等待所有线程执行完毕。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　在 Go 语言中有自己推荐的方式，它要比这些方法都优雅得多。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　要让主函数等待所有 goroutine 退出后再返回，如何知道 goroutine 都退出了呢？这就引出了多个 goroutine 之间通信的问题。</span>
</p>

<h1 id="toc_3" class="h16">并发通信</h1>

<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　从上面的例子中可以看到，关键字 go 的引入使得在 Go 语言中并发编程变得简单而优雅，但我们同时也应该意识到并发编程的原生复杂性，并时刻对并发中容易出现的问题保持警惕。别忘了，我们的例子还不能正常工作呢。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　事实上，不管是什么平台，什么编程语言，不管在哪，并发都是一个大话题。话题大小通常也直接对应于问题的大小。并发编程的难度在于协调，而协调就要通过交流。从这个角度看来，并发单元间的通信是最大问题。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　在工程上，有两种最常见的并发通信模型：<code>共享数据</code> 和 <code>消息</code>。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　<strong><code>共享数据</code>是指多个并发单元分别保持对同一个数据的引用，实现对该数据的共享</strong>。被共享的数据可能有多种形式，比如内存数据块、磁盘文件、网络数据等。在实际工程应用中最常见的无疑是内存了，也就是常说的<code>共享内存</code>。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　先看看在 C 语言中通常是怎么处理线程间数据共享的，如下代码清单所示。</span>
</p>


<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pthread.h&gt;

void *count();

pthread_mutex_t mutex1 = PTHREAD_MUTEX_INITIALIZER;

int counter = 0;

main()
{
    int rc1, rc2;
    pthread_t thread1, thread2;

    /* 创建线程，每个线程独立执行函数functionC */
    if((rc1 = pthread_create(&amp;thread1, NULL, &amp;add, NULL)))
    {
        printf("Thread creation failed: %d\n", rc1);
    }
    if((rc2 = pthread_create(&amp;thread2, NULL, &amp;add, NULL)))
    {
        printf("Thread creation failed: %d\n", rc2);
    }

    /* 等待所有线程执行完毕 */
    pthread_join( thread1, NULL);
    pthread_join( thread2, NULL);
    exit(0);
}

void *count()
{
    pthread_mutex_lock( &amp;mutex1 );
    counter++;
    printf("Counter value: %d\n",counter);
    pthread_mutex_unlock( &amp;mutex1 );
}</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　现在尝试将这段 C 语言代码直接翻译为 Go 语言代码，如下代码清单所示。</span>
</p>


<pre><code>package main

import "fmt"
import "sync"
import "runtime"

var counter int = 0

func Count(lock *sync.Mutex) {
    lock.Lock()
    counter++
    fmt.Println(z)
    lock.Unlock()
}

func main() {
    lock := &amp;sync.Mutex{}

    for i := 0; i &lt; 10; i++ {
        go Count(lock)
    }

    for {
        lock.Lock()
        c := counter
        lock.Unlock()
        runtime.Gosched()
        if c &gt;= 10 {
            break
        }
    }
}</code></pre>

<!--block_code_end-->
<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　此时这个例子终于可以正常工作了。在上面的例子中，我们在10个 goroutine 中共享了变量 counter。每个 goroutine 执行完成后，将 counter 的值加1。因为10个 goroutine 是并发执行的，所以我们还引入了锁，也就是代码中的 lock 变量。每次对 n 的操作，都要先将锁锁住，操作完成后，再将锁打开。在主函数中，使用 for 循环来不断检查 counter 的值（同样需要加锁）。当其值达到10时，说明所有 goroutine 都执行完毕了，这时主函数返回，程序退出。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　事情好像开始变得糟糕了。实现一个如此简单的功能，却写出如此臃肿而且难以理解的代码。想象一下，在一个大的系统中具有无数的锁、无数的共享变量、无数的业务逻辑与错误处理分支，那将是一场噩梦。这噩梦就是众多 C/C++ 开发者正在经历的，其实 Java 和 C# 开发者也好不到哪里去。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　Go 语言既然以并发编程作为语言的最核心优势，当然不至于将这样的问题用这么无奈的方式来解决。Go 语言提供的是另一种通信模型，即以消息机制而非共享内存作为通信方式。</span>
</p>


<p class="md_block">
    <span class="md_line md_line_start md_line_end">　　消息机制认为每个并发单元是自包含的、独立的个体，并且都有自己的变量，但在不同并发单元间这些变量不共享。<strong>每个并发单元的输入和输出只有一种，那就是消息</strong>。这有点类似于进程的概念，每个进程不会被其他进程打扰，它只做好自己的工作就可以了。不同进程间靠消息来通信，它们不会共享内存。</span>
</p>


<p class="md_block  md_has_block_below md_has_block_below_blockquote">
    <span class="md_line md_line_start md_line_end">　　<strong>Go 语言提供的消息通信机制被称为 <code>channel</code>，</strong>接下来我们将详细记录 channel。现在，用 Go 语言社区的那句著名的口号来结束这一小节：</span>
</p>


<blockquote class="blockquote_lines_2">
<p class="md_block">
    <span class="md_line md_line_start">　　不要通过共享内存来通信，而应该通过通信来共享内存。<br /></span>
    <span class="md_line md_line_dom_embed md_line_end"><!--blockquote--></span>
</p>

</blockquote>
            </div>
        </div>
        

    </div>

</div>





<div class="sidebar_clicker click_to_close_sidebar">
    <span class="bar"></span>
</div>




<script type="text/javascript" src="../asset/fit/jquery.js"></script>
<script type="text/javascript" src="../asset/fit/sidebar/auto_sidebar.js"></script>





<script>
    run_sidebar("left", 'sidebar', 270, "show");

    $(document).ready(function(){
        var sidebar = $('.index_body'); var current = $('.index_body .active');
        if (sidebar.length && current.length){ sidebar.scrollTop(current.offset().top - sidebar.height()/2 + 100);}
    })
</script>



</body>

</html>